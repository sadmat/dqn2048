import { Button, VerticalBox, GridBox } from "std-widgets.slint";
import { TrainingWidget } from "training/training-widget.slint";
import {
    Plots,
    UiTrainingStats,
    Actions,
    UiTrainingState,
} from "globals.slint";
import { PlotSize } from "size.slint";

export { PlotSize }
export { Plots, UiTrainingStats, Actions, UiTrainingState }

export component AppWindow inherits Window {

    MenuBar {
        Menu {
            title: "file";
            MenuItem {
                title: "save model";
                activated => {
                    Actions.save-model();
                }
            }

            MenuItem {
                title: "load model";
                activated => {
                    Actions.load-model();
                }
            }

            MenuSeparator { }

            MenuItem {
                title: "quit";
                activated => {
                    Actions.quit();
                }
            }
        }
    }

    VerticalLayout {
        training-widget := TrainingWidget {
            state: UiTrainingStats.state;
            epoch: UiTrainingStats.epoch;
            epochs-per-second: UiTrainingStats.epochs-per-second;
            best-score: UiTrainingStats.best-score;
            best-tile: UiTrainingStats.best-tile;
            recorded-transitions: UiTrainingStats.recorded-states;
            epsilon: UiTrainingStats.epsilon;
            score-plot: Plots.score-plot;
            reward-plot: Plots.reward-plot;
            best-tile-plot: Plots.best-tile-plot;
            changed plots-area-size => {
                if (Plots.plots-area-size != self.plots-area-size) {
                    Plots.plots-area-size = self.plots-area-size;
                    Actions.plots-area-size-changed()
                }
            }
        }
    }

    public function force-plots-area-size-update() {
        Plots.plots-area-size = training-widget.plots-area-size;
        Actions.plots-area-size-changed();
    }
}
